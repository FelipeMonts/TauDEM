#  Tell the program where the package libraries are  #####################
.libPaths("C:/Felipe/SotwareANDCoding/R_Library/library")  ;
#      set the working directory
setwd("C:\\Felipe\\PIHM-CYCLES\\PIHM\\TauDEM\\TauDEM\\LoganDemo\\Logan")
library(raster)
library(shapefiles)
setwd("C:\\Felipe\\PIHM-CYCLES\\PIHM\\TauDEM\\TauDEM\\LoganDemo\\Logan")
z=raster("logan.tif")
plot(z)
# Pitremove
system("mpiexec -n 8 pitremove -z logan.tif -fel loganfel.tif")
fel=raster("loganfel.tif")
plot(fel)
# D8 flow directions
system("mpiexec -n 8 D8Flowdir -p loganp.tif -sd8 logansd8.tif -fel loganfel.tif",show.output.on.console=F,invisible=F)
p=raster("loganp.tif")
plot(p)
sd8=raster("logansd8.tif")
plot(sd8)
# Contributing area
system("mpiexec -n 8 AreaD8 -p loganp.tif -ad8 loganad8.tif")
ad8=raster("loganad8.tif")
plot(log(ad8))
zoom(log(ad8))
# Threshold
system("mpiexec -n 8 Threshold -ssa loganad8.tif -src logansrc.tif -thresh 100")
src=raster("logansrc.tif")
plot(src)
zoom(src)
# Threshold
system("mpiexec -n 8 Threshold -ssa loganad8.tif -src logansrc.tif -thresh 100")
src=raster("logansrc.tif")
plot(src)
zoom(src)
# a quick R function to write a shapefile
makeshape.r=function(sname="shape",n=1)
{
xy=locator(n=n)
points(xy)
#Point
dd <- data.frame(Id=1:n,X=xy$x,Y=xy$y)
ddTable <- data.frame(Id=c(1),Name=paste("Outlet",1:n,sep=""))
ddShapefile <- convert.to.shapefile(dd, ddTable, "Id", 1)
write.shapefile(ddShapefile, sname, arcgis=T)
}
makeshape.r("ApproxOutlets")
system("mpiexec -n 8 moveoutletstostreams -p loganp.tif -src logansrc.tif -o approxoutlets.shp -om Outlet.shp")
outpt=read.shp("outlet.shp")
approxpt=read.shp("ApproxOutlets.shp")
plot(src)
makeshape.r=function(sname="shape",n=1)
{
xy=locator(n=n)
points(xy)
#Point
dd <- data.frame(Id=1:n,X=xy$x,Y=xy$y)
ddTable <- data.frame(Id=c(1),Name=paste("Outlet",1:n,sep=""))
ddShapefile <- convert.to.shapefile(dd, ddTable, "Id", 1)
write.shapefile(ddShapefile, sname, arcgis=T)
}
makeshape.r("ApproxOutlets")
# Move Outlets
system("mpiexec -n 8 moveoutletstostreams -p loganp.tif -src logansrc.tif -o approxoutlets.shp -om Outlet.shp")
outpt=read.shp("outlet.shp")
approxpt=read.shp("ApproxOutlets.shp")
plot(src)
points(outpt$shp[2],outpt$shp[3],pch=19,col=2)
points(approxpt$shp[2],approxpt$shp[3],pch=19,col=4)
# Contributing area upstream of outlet
system("mpiexec -n 8 Aread8 -p loganp.tif -o Outlet.shp -ad8 loganssa.tif")
ssa=raster("loganssa.tif")
plot(ssa)
# Threshold
system("mpiexec -n 8 threshold -ssa loganssa.tif -src logansrc1.tif -thresh 2000")
src1=raster("logansrc1.tif")
plot(src1)
# Stream Reach and Watershed
system("mpiexec -n 8 Streamnet -fel loganfel.tif -p loganp.tif -ad8 loganad8.tif -src logansrc1.tif -o outlet.shp -ord loganord.tif -tree logantree.txt -coord logancoord.txt -net logannet.shp -w loganw.tif")
plot(raster("loganord.tif"))
plot(raster("loganw.tif"))
# Plot streams using stream order as width
snet=read.shapefile("logannet")
ns=length(snet$shp$shp)
for(i in 1:ns)
{
lines(snet$shp$shp[[i]]$points,lwd=snet$dbf$dbf$Order[i])
}
# Plot streams using stream order as width
snet=read.shapefile("logannet")
# Plot streams using stream order as width
snet=read.shapefile("logannet")
.libPaths("C:/Felipe/SotwareANDCoding/R_Library/library")  ;
#      set the working directory
setwd("C:\\Felipe\\PIHM-CYCLES\\PIHM\\TauDEM\\TauDEM\\HalfMoon")
library(raster)
library(shapefiles)
setwd("C:\\Felipe\\PIHM-CYCLES\\PIHM\\TauDEM\\TauDEM\\HalfMoon")
z=raster("HT_Elevation.tif")
plot(z)
# Pitremove
system("mpiexec -n 8 pitremove -z HT_Elevation.tif -fel HT_Elevationfel.tif")
fel=raster("HT_Elevationfel.tif")
plot(fel)
# D8 flow directions
system("mpiexec -n 8 D8Flowdir -p HT_Elevationp.tif -sd8 HT_Elevation8.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
p=raster("HT_Elevationp.tif")
plot(p)
sd8=raster("HT_Elevation8.tif")
plot(sd8)
# Contributing area
system("mpiexec -n 8 AreaD8 -p HT_Elevationp.tif -ad8 HT_Elevationd8.tif")
# Contributing area
system("mpiexec -n 8 AreaD8 -p HT_Elevationp.tif -ad8 HT_Elevationad8.tif")
ad8=raster("HT_Elevationad8.tif")
plot(log(ad8))
# Grid Network
system("mpiexec -n 8 Gridnet -p HT_Elevationp.tif -gord HT_Elevationgord.tif -plen HT_Elevationplen.tif -tlen HT_Elevationtlen.tif")
gord=raster("HT_Elevationgord.tif")
plot(gord)
# DInf flow directions
system("mpiexec -n 8 DinfFlowdir -ang HT_Elevationang.tif -slp HT_Elevationslp.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
ang=raster("HT_Elevationang.tif")
plot(ang)
slp=raster("HT_Elevationslp.tif")
plot(slp)
# Dinf contributing area
system("mpiexec -n 8 AreaDinf -ang HT_Elevationang.tif -sca HT_Elevationsca.tif")
sca=raster("HT_Elevationsca.tif")
plot(log(sca))
# Threshold
system("mpiexec -n 8 Threshold -ssa HT_Elevationad8.tif -src  HT_Elevationrc.tif -thresh 6500")
src=raster("HT_Elevationrc.tif")
plot(src)
z=raster("HT_Elevation.asc")
plot(z)
# Pitremove
system("mpiexec -n 8 pitremove -z HT_Elevation.asc -fel HT_Elevationfel.tif")
fel=raster("HT_Elevationfel.tif")
plot(fel)
system("mpiexec -n 8 D8Flowdir -p HT_Elevationp.tif -sd8 HT_Elevation8.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
p=raster("HT_Elevationp.tif")
plot(p)
sd8=raster("HT_Elevation8.tif")
plot(sd8)
# Contributing area
system("mpiexec -n 8 AreaD8 -p HT_Elevationp.tif -ad8 HT_Elevationad8.tif")
ad8=raster("HT_Elevationad8.tif")
plot(log(ad8))
# Grid Network
system("mpiexec -n 8 Gridnet -p HT_Elevationp.tif -gord HT_Elevationgord.tif -plen HT_Elevationplen.tif -tlen HT_Elevationtlen.tif")
gord=raster("HT_Elevationgord.tif")
plot(gord)
# DInf flow directions
system("mpiexec -n 8 DinfFlowdir -ang HT_Elevationang.tif -slp HT_Elevationslp.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
ang=raster("HT_Elevationang.tif")
plot(ang)
plot(slp)
# Dinf contributing area
system("mpiexec -n 8 AreaDinf -ang HT_Elevationang.tif -sca HT_Elevationsca.tif")
sca=raster("HT_Elevationsca.tif")
plot(log(sca))
# Threshold
system("mpiexec -n 8 Threshold -ssa HT_Elevationad8.tif -src  HT_Elevationrc.tif -thresh 6500")
src=raster("HT_Elevationrc.tif")
plot(src)
plot(sca)
# Grid Network
system("mpiexec -n 8 Gridnet -p HT_Elevationp.tif -gord HT_Elevationgord.tif -plen HT_Elevationplen.tif -tlen HT_Elevationtlen.tif")
gord=raster("HT_Elevationgord.tif")
plot(gord)
plot(p)
# Contributing area
system("mpiexec -n 8 AreaD8 -p HT_Elevationp.tif -ad8 HT_Elevationad8.tif")
ad8=raster("HT_Elevationad8.tif")
plot(log(ad8))
plot(ad8)
setwd("C:\\Felipe\\PIHM-CYCLES\\PIHM\\TauDEM\\TauDEM\\HalfMoon")
z=raster("HT_Elevation.tif")
plot(z)
# Pitremove
system("mpiexec -n 8 pitremove -z HT_Elevation.asc -fel HT_Elevationfel.tif")
fel=raster("HT_Elevationfel.tif")
plot(fel)
# D8 flow directions
system("mpiexec -n 8 D8Flowdir -p HT_Elevationp.tif -sd8 HT_Elevation8.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
p=raster("HT_Elevationp.tif")
plot(p)
sd8=raster("HT_Elevation8.tif")
plot(sd8)
plot(sd8)
plot(sd8)
# D8 flow directions
system("mpiexec -n 8 D8Flowdir -p HT_Elevationp.tif -sd8 HT_Elevationsd8.tif -fel HT_Elevationfel.tif",show.output.on.console=F,invisible=F)
p=raster("HT_Elevationp.tif")
plot(p)
sd8=raster("HT_Elevation8.tif")
plot(sd8)
sd8=raster("HT_Elevationsd8.tif")
plot(sd8)
